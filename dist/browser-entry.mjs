/*! Glean Logger v1.1.0 (Browser) | MIT License */
var B=Object.defineProperty;var N=(r,e,t)=>e in r?B(r,e,{enumerable:true,configurable:true,writable:true,value:t}):r[e]=t;var m=(r,e,t)=>N(r,typeof e!="symbol"?e+"":e,t);var f={enabled:true,redactSensitive:true,includeStackTrace:true,maxFileSize:10485760,maxFiles:14,logDir:"./_logs",jsonFormat:true,developmentFormat:true},_=["debug","info","warn","error","fatal"];function U(r,e){if(!r)return e;let t=r.toLowerCase();return _.includes(t)?t:(console.warn(`Invalid log level "${r}", using default "${e}"`),e)}function d(r,e){return r===void 0?e:r.toLowerCase()==="true"}function M(r,e){if(!r)return e;let t=r.toLowerCase().match(/^(\d+)([bkmg])?$/);if(!t?.[1])return e;let n=parseInt(t[1],10);switch(t[2]??void 0){case "g":return n*1024*1024*1024;case "m":return n*1024*1024;case "k":return n*1024;default:return n}}function A(r,e){if(!r)return e;let t=r.toLowerCase().match(/^(\d+)([dwh])?$/);if(!t?.[1])return e;let n=parseInt(t[1],10);switch(t[2]??void 0){case "w":return n*7;case "h":return Math.ceil(n/24);default:return n}}var L=null;function w(){if(L)return L;let r=U(process.env.NEXT_PUBLIC_LOG_LEVEL,"debug");return L={...f,level:r,enabled:d(process.env.NEXT_PUBLIC_LOG_ENABLED,f.enabled),redactSensitive:d(process.env.API_LOG_REDACT_SENSITIVE,f.redactSensitive),includeStackTrace:d(void 0,f.includeStackTrace),maxFileSize:M(process.env.LOG_MAX_SIZE,f.maxFileSize),maxFiles:A(process.env.LOG_MAX_FILES,f.maxFiles),logDir:process.env.LOG_DIR||f.logDir,jsonFormat:d(void 0,f.jsonFormat),developmentFormat:d(void 0,f.developmentFormat)},L}function T(){return w().enabled}function k(r){if(!T())return  false;let e=w(),t={debug:0,info:1,warn:2,error:3,fatal:4};return t[r]>=t[e.level]}var C={debug:"\x1B[90m",info:"\x1B[32m",warn:"\x1B[33m",error:"\x1B[31m",fatal:"\x1B[35m"},J="\x1B[0m";function j(r){return (r?new Date(r):new Date).toISOString()}function K(r){return `${C[r]||C.info}${r.toUpperCase().padEnd(5)}${J}`}function G(r,e){if(!e||Object.keys(e).length===0)return r;let t=Object.entries(e).map(([n,o])=>{let i=typeof o=="object"?JSON.stringify(o):String(o);return ` ${n}=${i}`}).join("");return `${r}${t}`}function I(r,e,t,n){let o=j(n),i=K(r),u=G(e,t);return `[${o}] ${i} ${u}`}function R(r,e,t){return {level:r,message:e,context:t}}function x(){return typeof window<"u"}function P(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{let e=Math.random()*16|0;return (r==="x"?e:e&3|8).toString(16)})}function $(){return Date.now()}var z="glean_api_logs",V=100,b=class{constructor(e={}){m(this,"options");m(this,"config",w());this.options={maxEntries:e.maxEntries??V,storageKey:e.storageKey??z,consoleEnabled:e.consoleEnabled??true,persistenceEnabled:e.persistenceEnabled??true};}log(e,t,n){if(!T()||!k(e))return;let o=R(e,t,n),i=$();if(this.options.consoleEnabled){let u=I(e,t,n,i);console.log(u);}this.options.persistenceEnabled&&x()&&this.persistEntry(o,i);}persistEntry(e,t){if(x())try{let n=this.getStoredLogsRaw(),o={...e,id:P(),timestamp:t};for(n.entries.push(o);n.entries.length>this.options.maxEntries;)n.entries.shift();n.lastUpdated=t,localStorage.setItem(this.options.storageKey,JSON.stringify(n));}catch{console.warn("[BrowserLogger] localStorage unavailable or quota exceeded");}}getStoredLogsRaw(){if(!x())return {entries:[],lastUpdated:0,version:1};try{let e=localStorage.getItem(this.options.storageKey);if(!e)return {entries:[],lastUpdated:0,version:1};let t=JSON.parse(e);return {entries:Array.isArray(t.entries)?t.entries:[],lastUpdated:t.lastUpdated||0,version:t.version||1}}catch{return {entries:[],lastUpdated:0,version:1}}}debug(e,t){this.log("debug",e,t);}info(e,t){this.log("info",e,t);}warn(e,t){this.log("warn",e,t);}error(e,t){this.log("error",e,t);}getStoredLogs(){return [...this.getStoredLogsRaw().entries].sort((t,n)=>t.timestamp-n.timestamp)}clearStoredLogs(){if(x())try{localStorage.removeItem(this.options.storageKey);}catch{console.warn("[BrowserLogger] Failed to clear stored logs");}}async flush(){console.log("[BrowserLogger] flush() called - server sync not yet implemented");}},E=null;function X(){return E||(E=new b),E}X();function D(r){return new b(r)}function g(){if(typeof performance<"u"&&performance.now&&performance.now()>0)return performance.now();if(typeof process<"u"&&process.hrtime){let[r,e]=process.hrtime();return r*1e3+e/1e6}return Date.now()}function q(){return g()*1e3}function a(r){return r<1?`${(r*1e3).toFixed(2)}\u03BCs`:r<1e3?`${r.toFixed(2)}ms`:r<6e4?`${(r/1e3).toFixed(2)}s`:`${(r/6e4).toFixed(2)}m`}function H(r){let e=g(),t=r(),n=g(),o=Math.max(n-e,.01);return {result:t,duration:o,formatted:a(o),start:e,end:n}}async function W(r){let e=g(),t=await r(),n=g(),o=Math.max(n-e,.01);return {result:t,duration:o,formatted:a(o),start:e,end:n}}var v=class{constructor(){m(this,"startTime");m(this,"laps",new Map);m(this,"cumulativeTime",0);m(this,"running",true);this.startTime=g();}elapsed(){let e=g();return this.running?Math.max(e-this.startTime,0):this.cumulativeTime}formattedElapsed(){return a(this.elapsed())}lap(e){let t=this.elapsed();return this.laps.set(e,t),t}getLaps(){return new Map(this.laps)}getLap(e){return this.laps.get(e)}reset(){this.startTime=g(),this.laps.clear(),this.cumulativeTime=0,this.running=true;}stop(){return this.cumulativeTime=this.elapsed(),this.running=false,this.cumulativeTime}restart(){return this.reset(),this}checkpoint(){return this.elapsed()}},O={api:{warning:200,critical:1e3},db:{warning:100,critical:500},cache:{warning:10,critical:50},render:{warning:16,critical:100},file:{warning:50,critical:200},external:{warning:500,critical:3e3}},F=(n=>(n.OK="ok",n.WARNING="warning",n.CRITICAL="critical",n))(F||{});function h(r,e=O.api,t="operation"){return r>=e.critical?{level:"critical",duration:r,formatted:a(r),threshold:"critical",message:`${t} took too long (${a(r)}, critical threshold: ${a(e.critical)})`}:r>=e.warning?{level:"warning",duration:r,formatted:a(r),threshold:"warning",message:`${t} is slow (${a(r)}, warning threshold: ${a(e.warning)})`}:{level:"ok",duration:r,formatted:a(r),message:`${t} completed in ${a(r)}`}}function Y(r,e=O.api){return {track(t,n,o){let i=g(),u=n(),l=g(),s=Math.max(l-i,.01),c=h(s,e,t);return c.level==="ok"?r.logOperation(t,s,o):r.logSlowOperation(t,s,c.threshold,o),{result:u,duration:s,formatted:a(s),start:i,end:l}},async trackAsync(t,n,o){let i=g(),u=await n(),l=g(),s=Math.max(l-i,.01),c=h(s,e,t);return c.level==="ok"?r.logOperation(t,s,o):r.logSlowOperation(t,s,c.threshold,o),{result:u,duration:s,formatted:a(s),start:i,end:l}},startTimer(){return new v},check(t,n){return h(n,e,t)}}}function Z(r,e={warning:6e4,critical:0}){let t=new Map;return {logOperation:(n,o,i)=>{r.logOperation(n,o,i);},logSlowOperation:(n,o,i,u)=>{let l=`${n}:${i}`,s=Date.now(),c=t.get(l)??0;(i==="critical"||s-c>=e[i])&&(r.logSlowOperation(n,o,i,u),t.set(l,s));}}}var S=class{constructor(){m(this,"metrics",new Map);}record(e,t){let n=this.metrics.get(e)??[];n.push(t),this.metrics.set(e,n);}getStats(e){let t=this.metrics.get(e);if(!t||t.length===0)return null;let n=[...t].sort((c,p)=>c-p),o=n.length,i=n[0],u=n[o-1],l=n.reduce((c,p)=>c+p,0)/o,s=c=>{let p=Math.floor(o*c);return n[Math.min(p,o-1)]};return {count:o,min:i,max:u,avg:l,p50:s(.5),p95:s(.95),p99:s(.99)}}getMetricNames(){return Array.from(this.metrics.keys())}clear(){this.metrics.clear();}},y={now:g,nowMicro:q,formatDuration:a,time:H,timeAsync:W,Stopwatch:v,DEFAULT_THRESHOLDS:O,PerformanceLevel:F,checkPerformance:h,createPerformanceTracker:Y,createThrottledLogger:Z,MetricsAggregator:S};function de(r){return D({consoleEnabled:true,persistenceEnabled:true,maxEntries:100,storageKey:"glean_api_logs"})}async function xe(r,e){let t=y.now(),n=await e(),o=y.now()-t;return {result:n,duration:o}}export{de as logger,xe as measure,y as performance};//# sourceMappingURL=browser-entry.mjs.map
//# sourceMappingURL=browser-entry.mjs.map