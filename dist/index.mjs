import k from'winston';import Ge from'winston-daily-rotate-file';/*! Glean Logger v1.0.0 | MIT License */
var M=Object.defineProperty;var ke=Object.getOwnPropertyDescriptor;var Re=Object.getOwnPropertyNames;var Ie=Object.prototype.hasOwnProperty;var L=(t,e)=>()=>(t&&(e=t(t=0)),e);var j=(t,e)=>{for(var r in e)M(t,r,{get:e[r],enumerable:true});},De=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Re(e))!Ie.call(t,o)&&o!==r&&M(t,o,{get:()=>e[o],enumerable:!(n=ke(e,o))||n.enumerable});return t};var U=t=>De(M({},"__esModule",{value:true}),t);function Oe(t,e){if(!t)return e;let r=t.toLowerCase();return Fe.includes(r)?r:(console.warn(`Invalid log level "${t}", using default "${e}"`),e)}function v(t,e){return t===void 0?e:t.toLowerCase()==="true"}function Pe(t,e){if(!t)return e;let r=t.toLowerCase().match(/^(\d+)([bkmg])?$/);if(!r?.[1])return e;let n=parseInt(r[1],10);switch(r[2]??void 0){case "g":return n*1024*1024*1024;case "m":return n*1024*1024;case "k":return n*1024;default:return n}}function Be(t,e){if(!t)return e;let r=t.toLowerCase().match(/^(\d+)([dwh])?$/);if(!r?.[1])return e;let n=parseInt(r[1],10);switch(r[2]??void 0){case "w":return n*7;case "h":return Math.ceil(n/24);default:return n}}function f(){if(F)return F;let t=Oe(process.env.NEXT_PUBLIC_LOG_LEVEL,"debug");return F={...p,level:t,enabled:v(process.env.NEXT_PUBLIC_LOG_ENABLED,p.enabled),redactSensitive:v(process.env.API_LOG_REDACT_SENSITIVE,p.redactSensitive),includeStackTrace:v(void 0,p.includeStackTrace),maxFileSize:Pe(process.env.LOG_MAX_SIZE,p.maxFileSize),maxFiles:Be(process.env.LOG_MAX_FILES,p.maxFiles),logDir:process.env.LOG_DIR||p.logDir,jsonFormat:v(void 0,p.jsonFormat),developmentFormat:v(void 0,p.developmentFormat)},F}function G(){return f().enabled}function oe(t){if(!G())return  false;let e=f(),r={debug:0,info:1,warn:2,error:3,fatal:4};return r[t]>=r[e.level]}function ie(){return f().logDir}function se(){return process.env.NODE_ENV==="development"}var p,Fe,F,O=L(()=>{p={enabled:true,redactSensitive:true,includeStackTrace:true,maxFileSize:10485760,maxFiles:14,logDir:"./_logs",jsonFormat:true,developmentFormat:true},Fe=["debug","info","warn","error","fatal"];F=null;});function C(){return typeof window<"u"}function H(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return (t==="x"?e:e&3|8).toString(16)})}function J(){return H()}function T(){return new Date().toISOString()}function ue(){return Date.now()}function h(){return typeof performance<"u"&&performance.now?performance.now():Date.now()}var K=L(()=>{});var xe={};j(xe,{DEFAULT_THRESHOLDS:()=>A,MetricsAggregator:()=>B,PerformanceLevel:()=>X,Stopwatch:()=>S,checkPerformance:()=>E,createPerformanceTracker:()=>pe,createThrottledLogger:()=>he,default:()=>Ue,formatDuration:()=>d,noopPerformanceLogger:()=>je,now:()=>l,nowMicro:()=>le,perf:()=>W,time:()=>me,timeAsync:()=>fe});function l(){if(typeof performance<"u"&&performance.now&&performance.now()>0)return performance.now();if(typeof process<"u"&&process.hrtime){let[t,e]=process.hrtime();return t*1e3+e/1e6}return Date.now()}function le(){return l()*1e3}function d(t){return t<1?`${(t*1e3).toFixed(2)}\u03BCs`:t<1e3?`${t.toFixed(2)}ms`:t<6e4?`${(t/1e3).toFixed(2)}s`:`${(t/6e4).toFixed(2)}m`}function me(t){let e=l(),r=t(),n=l(),o=Math.max(n-e,.01);return {result:r,duration:o,formatted:d(o),start:e,end:n}}async function fe(t){let e=l(),r=await t(),n=l(),o=Math.max(n-e,.01);return {result:r,duration:o,formatted:d(o),start:e,end:n}}function E(t,e=A.api,r="operation"){return t>=e.critical?{level:"critical",duration:t,formatted:d(t),threshold:"critical",message:`${r} took too long (${d(t)}, critical threshold: ${d(e.critical)})`}:t>=e.warning?{level:"warning",duration:t,formatted:d(t),threshold:"warning",message:`${r} is slow (${d(t)}, warning threshold: ${d(e.warning)})`}:{level:"ok",duration:t,formatted:d(t),message:`${r} completed in ${d(t)}`}}function pe(t,e=A.api){return {track(r,n,o){let i=l(),s=n(),a=l(),c=Math.max(a-i,.01),g=E(c,e,r);return g.level==="ok"?t.logOperation(r,c,o):t.logSlowOperation(r,c,g.threshold,o),{result:s,duration:c,formatted:d(c),start:i,end:a}},async trackAsync(r,n,o){let i=l(),s=await n(),a=l(),c=Math.max(a-i,.01),g=E(c,e,r);return g.level==="ok"?t.logOperation(r,c,o):t.logSlowOperation(r,c,g.threshold,o),{result:s,duration:c,formatted:d(c),start:i,end:a}},startTimer(){return new S},check(r,n){return E(n,e,r)}}}function he(t,e={warning:6e4,critical:0}){let r=new Map;return {logOperation:(n,o,i)=>{t.logOperation(n,o,i);},logSlowOperation:(n,o,i,s)=>{let a=`${n}:${i}`,c=Date.now(),g=r.get(a)??0;(i==="critical"||c-g>=e[i])&&(t.logSlowOperation(n,o,i,s),r.set(a,c));}}}var S,A,X,je,B,W,Ue,Y=L(()=>{S=class{startTime;laps=new Map;cumulativeTime=0;running=true;constructor(){this.startTime=l();}elapsed(){let e=l();return this.running?Math.max(e-this.startTime,0):this.cumulativeTime}formattedElapsed(){return d(this.elapsed())}lap(e){let r=this.elapsed();return this.laps.set(e,r),r}getLaps(){return new Map(this.laps)}getLap(e){return this.laps.get(e)}reset(){this.startTime=l(),this.laps.clear(),this.cumulativeTime=0,this.running=true;}stop(){return this.cumulativeTime=this.elapsed(),this.running=false,this.cumulativeTime}restart(){return this.reset(),this}checkpoint(){return this.elapsed()}},A={api:{warning:200,critical:1e3},db:{warning:100,critical:500},cache:{warning:10,critical:50},render:{warning:16,critical:100},file:{warning:50,critical:200},external:{warning:500,critical:3e3}},X=(n=>(n.OK="ok",n.WARNING="warning",n.CRITICAL="critical",n))(X||{});je={logOperation:()=>{},logSlowOperation:()=>{}};B=class{metrics=new Map;record(e,r){let n=this.metrics.get(e)??[];n.push(r),this.metrics.set(e,n);}getStats(e){let r=this.metrics.get(e);if(!r||r.length===0)return null;let n=[...r].sort((g,m)=>g-m),o=n.length,i=n[0],s=n[o-1],a=n.reduce((g,m)=>g+m,0)/o,c=g=>{let m=Math.floor(o*g);return n[Math.min(m,o-1)]};return {count:o,min:i,max:s,avg:a,p50:c(.5),p95:c(.95),p99:c(.99)}}getMetricNames(){return Array.from(this.metrics.keys())}clear(){this.metrics.clear();}},W={now:l,nowMicro:le,formatDuration:d,time:me,timeAsync:fe,Stopwatch:S,DEFAULT_THRESHOLDS:A,PerformanceLevel:X,checkPerformance:E,createPerformanceTracker:pe,createThrottledLogger:he,MetricsAggregator:B},Ue=W;});function He(){return new k.transports.Console({format:k.format.combine(k.format.colorize(),k.format.printf(({level:t,message:e,timestamp:r})=>{let n=f();return se()&&n.developmentFormat?`${r} [${t}] ${e}`:JSON.stringify({"@timestamp":r,level:t.toUpperCase(),message:e})}))})}function Z(t,e){let r=ie(),n=f();return new Ge({dirname:r,filename:`${t}.%DATE%.log`,datePattern:"YYYY-MM-DD",maxSize:n.maxFileSize,maxFiles:n.maxFiles,level:e,format:k.format.json()})}function Je(){f();let e=[];return e.push(He()),e.push(Z("combined","debug")),e.push(Z("api","info")),e.push(Z("error","error")),e}function Le(){return {level:f().level,transports:Je(),exitOnError:false,handleExceptions:true,handleRejections:true,silent:false}}var be=L(()=>{O();});var Q={};j(Q,{ServerLoggerImpl:()=>N,createServerLogger:()=>R,default:()=>Ve});function R(t){return new N(t)}var N,Ve,$=L(()=>{O();be();N=class t{winston;context={};loggerName;constructor(e){let r=f();this.loggerName=e?.name||"server-logger",this.winston=k.createLogger({...Le(),level:e?.level??r.level,defaultMeta:()=>this.context});}debug(e,r){this.winston.debug(e,this.formatContext(r));}info(e,r){this.winston.info(e,this.formatContext(r));}warn(e,r){this.winston.warn(e,this.formatContext(r));}error(e,r){this.winston.error(e,this.formatContext(r));}fatal(e,r){this.winston.error(e,this.formatContext(r));}child(e){let r=new t({name:this.loggerName});return r.context={...this.context,...e},r}with(e){let r=new t({name:this.loggerName});return r.context={...this.context,...e},r}formatContext(e){if(!(!e||Object.keys(e).length===0))return e}static flush(){}};Ve=R;});var Ee={};j(Ee,{ApiLoggerBuilder:()=>b,ApiLoggerImpl:()=>_,DEFAULT_BODY_LOGGING_CONFIG:()=>u,applyRedaction:()=>w,createApiLogger:()=>I,createBodyLoggingConfig:()=>Xe,createFetchInterceptor:()=>nt,createLoggedFetch:()=>Te,default:()=>it,getBodyType:()=>We,isBinaryContentType:()=>ye,parseDuration:()=>te,parseSize:()=>ee,redactBody:()=>Ce,redactHeaders:()=>ve,timeApiCall:()=>ot});function ee(t){let e=t.toLowerCase().match(/^(\d+(?:\.\d+)?)\s*(b|kb|mb|gb)?$/);if(!e)return u.maxSize;let r=parseFloat(e[1]),n=e[2]||"b",o={b:1,kb:1024,mb:1024**2,gb:1024**3};return Math.floor(r*(o[n]??1))}function te(t){let e=t.toLowerCase().match(/^(\d+(?:\.\d+)?)\s*(ms|s|m)?$/);if(!e)return u.readTimeout;let r=parseFloat(e[1]),n=e[2]||"ms",o={ms:1,s:1e3,m:60*1e3};return Math.floor(r*(o[n]??1))}function Xe(){return new b}function ye(t){let e=t.toLowerCase();return (u.contentTypeFilter.exclude??[]).some(n=>n.includes("*")?new RegExp("^"+n.replace(/\*/g,".*")+"$").test(e):e.includes(n))}function We(t){let e=t.toLowerCase();return e.includes("json")||e.includes("application/xml")||e.includes("text/")?e.includes("json")?"json":"text":ye(e)?null:"text"}function we(t,e){let r=e.toLowerCase(),n=t.toLowerCase();return r===n?true:r.includes("*")?new RegExp("^"+r.replace(/\*/g,".*")+"$").test(n):n.startsWith(r)}function Ye(t,e){let r=t.toLowerCase();for(let n of e.exclude??[])if(we(r,n))return  false;if(e.include&&e.include.length>0){for(let n of e.include)if(we(r,n))return  true;return  false}return  true}function Ze(t,e){return (!e.patterns||e.patterns.length===0||e.patterns.some(n=>n.includes("*")?new RegExp("^"+n.replace(/\*/g,".*")+"$").test(t):t.includes(n)))&&Math.random()<e.rate}function w(t,e,r,n=0){let o=e.maxDepth??10;if(n>o)return "[MAX_DEPTH_EXCEEDED]";if(!t||typeof t!="object")return t;if(r||(r=new WeakSet),r.has(t))return "[REDACTED-CIRCULAR]";if(r.add(t),Array.isArray(t))return t.map(s=>w(s,e,r,n));if(t instanceof Date)return t.toISOString();if(t instanceof RegExp)return t.source;let i={};for(let[s,a]of Object.entries(t)){let c=s.toLowerCase();if(e.sensitiveFields.some(m=>c===m.toLowerCase())){i[s]="[REDACTED]";continue}let g=a;for(let m of e.redactionPatterns)(!m.fieldNames||m.fieldNames.some(z=>c===z.toLowerCase()))&&typeof a=="string"&&(g=a.replace(m.pattern,m.replacement));typeof g=="object"&&g!==null?i[s]=w(g,e,r,n+1):i[s]=g;}return i}async function Qe(t,e,r){let n=new AbortController,o=setTimeout(()=>n.abort(),e);try{let i=t.headers.get("content-type")||"",s,a=!1;if(i.includes("json"))s=await t.json();else {let c=await t.text();c.length>r?(s=`${c.slice(0,r)}... [truncated]`,a=!0):s=c;}return clearTimeout(o),{body:s,truncated:a}}catch(i){if(clearTimeout(o),i.name==="AbortError")return null;throw i}}async function et(t,e,r){if(!e.enabled)return e.verbose&&console.debug("[BodyLogging] Body logging disabled"),null;if(e.skipStatusCodes.includes(t.status)||!t.body)return null;let n=t.headers.get("content-type")||"";if(!Ye(n,e.contentTypeFilter))return null;let o=t.headers.get("content-length");if(o){let i=parseInt(o,10);if(!isNaN(i)&&i>e.maxSize*2)return null}if(e.sampling&&r&&!Ze(r,e.sampling))return null;try{let i=t.clone(),s=await Qe(i,e.readTimeout,e.maxSize);if(!s)return null;let{body:a,truncated:c}=s;return {body:w(a,e),truncated:c}}catch{return null}}function tt(t,e){if(!t)return;let r={};for(let[n,o]of Object.entries(t)){let i=n.toLowerCase();e.sensitiveHeaders.some(s=>i===s.toLowerCase())?r[n]="[REDACTED]":r[n]=o;}return r}function rt(t,e){return w(t,e)}function ve(t){if(!t)return;let e={};for(let[r,n]of Object.entries(t)){let o=r.toLowerCase();u.sensitiveHeaders.includes(o)?e[r]="[REDACTED]":e[r]=n;}return e}function Ce(t){return w(t,u)}function I(t){return new _(t)}function Te(t){let e=t?.logger??I({name:"fetch-logger"}),r=t?.enabled??true,n;return t?.bodyLoggingConfig?n=t.bodyLoggingConfig:process.env.LOG_BODY_ENABLED!==void 0||process.env.LOG_BODY_MAX_SIZE!==void 0?n=new b().fromEnv().build():n=u,async function(i,s){if(!r)return fetch(i,s);let a=typeof i=="string"?i:i instanceof Request?i.url:i.toString(),c=J(),g=h(),z=t?.redactHeaders!==false?tt(s?.headers??{},n):s?.headers??{},y={requestId:c,method:s?.method??"GET",url:a,headers:z,body:rt(s?.body,n),timestamp:T()};e.logRequest(y);try{let x=await fetch(i,{...s,headers:{...s?.headers??{},"X-Request-ID":c}}),q=h()-g,ne=await et(x,n,a),Se={requestId:c,method:y.method,url:y.url,statusCode:x.status,duration:q,timestamp:T(),body:ne?ne.body:void 0};return e.logResponse(Se),x}catch(x){let q=h()-g;throw e.logError(x,{requestId:c,method:y.method,url:y.url,duration:q}),x}}}function nt(t){let e=t?.logger??I({name:"interceptor"}),r=t?.enabled??true;return {request:async(s,a)=>{if(!r)return {url:s,options:a};let c=J();return e.logRequest({requestId:c,method:a?.method??"GET",url:s,headers:ve(a?.headers??{}),body:Ce(a?.body),timestamp:T()}),{url:s,options:{...a,headers:{...a?.headers??{},"X-Request-ID":c}}}},response:async(s,a)=>{if(!r)return {url:s,options:a};let c=a?.headers?.["X-Request-ID"];return c&&e.logResponse({requestId:c,method:a?.method??"GET",url:s,timestamp:T()}),{url:s,options:a}},error:async(s,a)=>{if(!r)return {url:s,options:a};let c=a?.headers?.["X-Request-ID"];return c&&e.logError(new Error("Fetch failed"),{requestId:c,method:a?.method??"GET",url:s}),{url:s,options:a}}}}async function ot(t,e,r,n){let o=r??R({name:"perf"}),i=h();o.info(`${t} started`,n);try{let s=await e(),a=h()-i;return o.info(`${t} completed`,{...n,duration:a}),s}catch(s){let a=h()-i;throw o.error(`${t} failed`,{...n,duration:a,error:{message:s.message,name:s.name}}),s}}var u,b,_,it,D=L(()=>{$();K();u={enabled:true,maxSize:10*1024,readTimeout:5e3,maxDepth:10,contentTypeFilter:{exclude:["image/*","audio/*","video/*","application/pdf","application/zip","application/octet-stream","font/*","multipart/form-data"]},redactionPatterns:[{pattern:/\b\d{3}[-.\s]?\d{2}[-.\s]?\d{4}\b/g,replacement:"[REDACTED-SSN]",fieldNames:["ssn","socialsecuritynumber","taxid"]},{pattern:/\b\d{4}[-\s]?\d{4}[-\s]?\d{4}[-\s]?\d{4}\b/g,replacement:"[REDACTED-CARD]",fieldNames:["creditcard","cardnumber","ccnumber"]},{pattern:/Bearer\s+[A-Za-z0-9\-._~+/]+=*/gi,replacement:"Bearer [REDACTED]",fieldNames:["authorization"]}],sensitiveFields:["password","token","secret","apikey","accesstoken","refreshtoken","privatekey","ssn","creditcard","cardnumber","cvv","cvc"],sensitiveHeaders:["authorization","cookie","set-cookie","x-api-key","x-auth-token","x-forwarded-for"],skipStatusCodes:[204,304],verbose:false};b=class{config={};constructor(e){this.config={...e};}enabled(e){return this.config.enabled=e,this}maxSize(e){return this.config.maxSize=typeof e=="string"?ee(e):e,this}readTimeout(e){return this.config.readTimeout=typeof e=="string"?te(e):e,this}excludeContentTypes(...e){return this.config.contentTypeFilter||(this.config.contentTypeFilter={}),this.config.contentTypeFilter.exclude=[...this.config.contentTypeFilter.exclude??[],...e],this}includeContentTypes(...e){return this.config.contentTypeFilter||(this.config.contentTypeFilter={}),this.config.contentTypeFilter.include=[...this.config.contentTypeFilter.include??[],...e],this}addRedactionPattern(e,r,n){return this.config.redactionPatterns||(this.config.redactionPatterns=[]),this.config.redactionPatterns.push({pattern:e,replacement:r,fieldNames:n}),this}addSensitiveFields(...e){return this.config.sensitiveFields||(this.config.sensitiveFields=[]),this.config.sensitiveFields.push(...e.map(r=>r.toLowerCase())),this}addSensitiveHeaders(...e){return this.config.sensitiveHeaders||(this.config.sensitiveHeaders=[]),this.config.sensitiveHeaders.push(...e.map(r=>r.toLowerCase())),this}sampling(e,r){if(e<0||e>1)throw new Error("Sampling rate must be between 0 and 1");return this.config.sampling={rate:e,patterns:r},this}skipStatusCodes(...e){return this.config.skipStatusCodes||(this.config.skipStatusCodes=[]),this.config.skipStatusCodes.push(...e),this}verbose(e){return this.config.verbose=e,this}maxDepth(e){return this.config.maxDepth=e,this}basic(){return this.enabled(true).maxSize("10kb").readTimeout("5s").excludeContentTypes("image/*","video/*","application/pdf","font/*","multipart/form-data").addSensitiveFields("password","token","secret").skipStatusCodes(204,304).verbose(process.env.NODE_ENV==="development"||process.env.NODE_ENV===void 0)}production(){return this.enabled(true).maxSize("5kb").readTimeout("3s").excludeContentTypes("image/*","video/*","application/pdf","application/zip","font/*","multipart/form-data").addRedactionPattern(/\b\d{3}[-.\s]?\d{2}[-.\s]?\d{4}\b/g,"[REDACTED-SSN]",["ssn","socialsecuritynumber","taxid"]).addRedactionPattern(/\b\d{4}[-\s]?\d{4}[-\s]?\d{4}[-\s]?\d{4}\b/g,"[REDACTED-CARD]",["creditcard","cardnumber","ccnumber"]).addRedactionPattern(/Bearer\s+[A-Za-z0-9\-._~+/]+=*/gi,"Bearer [REDACTED]",["authorization"]).addSensitiveFields("password","token","secret","apikey","accesstoken","refreshtoken","privatekey","ssn","creditcard","cardnumber","cvv","cvc").addSensitiveHeaders("authorization","cookie","set-cookie","x-api-key","x-auth-token","x-forwarded-for").skipStatusCodes(204,304).verbose(false).maxDepth(5)}development(){return this.enabled(true).maxSize("50kb").readTimeout("10s").excludeContentTypes("image/*","video/*","application/pdf").addSensitiveFields("password","token","secret").skipStatusCodes(204,304).verbose(true).maxDepth(20)}minimal(){return this.enabled(false).maxSize("1kb").readTimeout("1s").excludeContentTypes("image/*","video/*","application/pdf","application/zip","font/*","multipart/form-data","application/octet-stream").addSensitiveFields("password","token","secret").skipStatusCodes(200,201,202,204,304).verbose(false).maxDepth(3)}fromEnv(e="LOG_BODY"){let r=process.env,n=Object.keys(r).filter(o=>o.startsWith(`${e}_`));for(let o of n){let i=r[o];if(!i)continue;switch(o.slice(`${e}_`.length).toLowerCase()){case "enabled":this.config.enabled=i==="true"||i==="1";break;case "max_size":this.config.maxSize=ee(i);break;case "read_timeout":this.config.readTimeout=te(i);break;case "sample_rate":{let a=parseFloat(i);!isNaN(a)&&a>=0&&a<=1&&(this.config.sampling={...this.config.sampling,rate:a});break}case "sensitive_fields":this.config.sensitiveFields=i.split(",").map(a=>a.trim().toLowerCase());break;case "sensitive_headers":this.config.sensitiveHeaders=i.split(",").map(a=>a.trim().toLowerCase());break;case "verbose":this.config.verbose=i==="true"||i==="1";break}}return this}build(){let e={...u,...this.config,contentTypeFilter:{...u.contentTypeFilter,...this.config.contentTypeFilter,exclude:[...u.contentTypeFilter.exclude??[],...this.config.contentTypeFilter?.exclude??[]],include:[...u.contentTypeFilter.include??[],...this.config.contentTypeFilter?.include??[]]},redactionPatterns:[...u.redactionPatterns??[],...this.config.redactionPatterns??[]],sensitiveFields:[...u.sensitiveFields??[],...this.config.sensitiveFields??[]],sensitiveHeaders:[...u.sensitiveHeaders??[],...this.config.sensitiveHeaders??[]],skipStatusCodes:[...u.skipStatusCodes??[],...this.config.skipStatusCodes??[]],maxDepth:this.config.maxDepth??u.maxDepth,sampling:this.config.sampling!==void 0?{...u.sampling,...this.config.sampling}:u.sampling};return this.validate(e),e}validate(e){if(e.maxSize<0)throw new Error("maxSize must be non-negative");if(e.maxSize>100*1024*1024)throw new Error("maxSize cannot exceed 100MB");if(e.readTimeout<0)throw new Error("readTimeout must be non-negative");if(e.sampling&&(e.sampling.rate<0||e.sampling.rate>1))throw new Error("sampling rate must be between 0 and 1");if(e.maxDepth!==void 0&&(e.maxDepth<1||e.maxDepth>100))throw new Error("maxDepth must be between 1 and 100")}};_=class{logger;constructor(e){this.logger=R({name:e?.name||"api-logger"});}logRequest(e){this.logger.info("API Request",{type:"request",requestId:e.requestId,method:e.method,url:e.url,headers:e.headers,timestamp:e.timestamp});}logResponse(e){this.logger.info("API Response",{type:"response",requestId:e.requestId,method:e.method,url:e.url,statusCode:e.statusCode,duration:e.duration,timestamp:e.timestamp,...e.body!==void 0&&{responseBody:e.body}});}logError(e,r){this.logger.error("API Error",{type:"error",error:{message:e.message,name:e.name,stack:e.stack},...r});}};it=I;});O();var ae={debug:"\x1B[90m",info:"\x1B[32m",warn:"\x1B[33m",error:"\x1B[31m",fatal:"\x1B[35m"},Ae="\x1B[0m";function Ne(t){return (t?new Date(t):new Date).toISOString()}function $e(t){return `${ae[t]||ae.info}${t.toUpperCase().padEnd(5)}${Ae}`}function _e(t,e){if(!e||Object.keys(e).length===0)return t;let r=Object.entries(e).map(([n,o])=>{let i=typeof o=="object"?JSON.stringify(o):String(o);return ` ${n}=${i}`}).join("");return `${t}${r}`}function ce(t,e,r,n){let o=Ne(n),i=$e(t),s=_e(e,r);return `[${o}] ${i} ${s}`}function ge(t,e,r){return {level:t,message:e,context:r}}K();var ze="glean_api_logs",qe=100,P=class{options;config=f();constructor(e={}){this.options={maxEntries:e.maxEntries??qe,storageKey:e.storageKey??ze,consoleEnabled:e.consoleEnabled??true,persistenceEnabled:e.persistenceEnabled??true};}log(e,r,n){if(!G()||!oe(e))return;let o=ge(e,r,n),i=ue();if(this.options.consoleEnabled){let s=ce(e,r,n,i);console.log(s);}this.options.persistenceEnabled&&C()&&this.persistEntry(o,i);}persistEntry(e,r){if(C())try{let n=this.getStoredLogsRaw(),o={...e,id:H(),timestamp:r};for(n.entries.push(o);n.entries.length>this.options.maxEntries;)n.entries.shift();n.lastUpdated=r,localStorage.setItem(this.options.storageKey,JSON.stringify(n));}catch{console.warn("[BrowserLogger] localStorage unavailable or quota exceeded");}}getStoredLogsRaw(){if(!C())return {entries:[],lastUpdated:0,version:1};try{let e=localStorage.getItem(this.options.storageKey);if(!e)return {entries:[],lastUpdated:0,version:1};let r=JSON.parse(e);return {entries:Array.isArray(r.entries)?r.entries:[],lastUpdated:r.lastUpdated||0,version:r.version||1}}catch{return {entries:[],lastUpdated:0,version:1}}}debug(e,r){this.log("debug",e,r);}info(e,r){this.log("info",e,r);}warn(e,r){this.log("warn",e,r);}error(e,r){this.log("error",e,r);}getStoredLogs(){return [...this.getStoredLogsRaw().entries].sort((r,n)=>r.timestamp-n.timestamp)}clearStoredLogs(){if(C())try{localStorage.removeItem(this.options.storageKey);}catch{console.warn("[BrowserLogger] Failed to clear stored logs");}}async flush(){console.log("[BrowserLogger] flush() called - server sync not yet implemented");}},V=null;function Me(){return V||(V=new P),V}Me();function de(t){return new P(t)}Y();D();D();D();var re=null;function Dt(t){if(typeof window<"u")return de({consoleEnabled:true,persistenceEnabled:true,maxEntries:100,storageKey:"glean_api_logs"});if(!re){let{createServerLogger:e}=($(),U(Q));re=e({name:t?.name??"server",level:t?.level});}return re}function Ft(t){if(typeof window<"u")return null;let{createServerLogger:e}=($(),U(Q));return e({name:"parent"}).child(t)}function Ot(t){if(typeof window<"u")return ()=>Promise.reject(new Error("loggedFetch is server-only"));let{createLoggedFetch:e}=(D(),U(Ee));return e(t)}async function Pt(t,e){if(typeof window<"u"){let o=performance.now(),i=await e(),s=performance.now()-o;return console.log(`${t}: ${s.toFixed(2)}ms`),{result:i,duration:s}}let n=await(await Promise.resolve().then(()=>(Y(),xe))).timeAsync(e);return {result:n.result,duration:n.duration}}export{b as ApiLoggerBuilder,Ft as child,I as createApiLogger,Te as createLoggedFetch,Ot as loggedFetch,Dt as logger,Pt as measure,W as performance};//# sourceMappingURL=index.mjs.map
//# sourceMappingURL=index.mjs.map